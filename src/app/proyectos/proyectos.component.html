<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round" />
<link
  rel="stylesheet"
  href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
/>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
<link
  rel="stylesheet"
  href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
/>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script>
  const myDialog = document.querySelector('#my-dialog');
  myDialog.showModal();

  function closeDialog() {
    myDialog.close();
  }

  $(document).ready(function () {
    // Activate tooltip
    $('[data-toggle="tooltip"]').tooltip();

    // Select/Deselect checkboxes
    var checkbox = $('table tbody input[type="checkbox"]');
    $('#selectAll').click(function () {
      if (this.checked) {
        checkbox.each(function () {
          this.checked = true;
        });
      } else {
        checkbox.each(function () {
          this.checked = false;
        });
      }
    });
    checkbox.click(function () {
      if (!this.checked) {
        $('#selectAll').prop('checked', false);
      }
    });
  });
</script>
<body>
  <br />
  <div class="container-fluid">
    <div class="container">
      <div class="row">
        <div class="col-sm-6">
          <h2>Mantenimiento de <b>Proyectos</b></h2>
        </div>

        <div class="col-sm-6 text-right">
          <button mat-raised-button color="primary" (click)="openDialog()">
            <mat-icon>add</mat-icon> Crear Proyecto
          </button>
        </div>
      </div>
      <br /><br />

      <div class="row">
        <div style="display: flex; align-items: center;">
          <app-buscar-proyecto (filtroChange)="aplicarFiltro($event)"></app-buscar-proyecto>
          <mat-form-field style="margin-left: 10px;">
            <input matInput [matDatepicker]="pickerFechaInicio" placeholder="Filtrar por fecha de inicio" [(ngModel)]="fechaInicioFilter" (ngModelChange)="filtrarPorFechaInicio()">
            <mat-datepicker-toggle matSuffix [for]="pickerFechaInicio"></mat-datepicker-toggle>
            <mat-datepicker #pickerFechaInicio></mat-datepicker>
          </mat-form-field>
          <button mat-button style="margin-left: 10px;" (click)="limpiarFiltros()" [disabled]="!pickerFechaInicioSeleccionada">Limpiar fecha</button>
        </div>



        <div class="col-12 col-md-4" *ngFor="let project of proyectosPaginados | filter: filtro">
          <mat-card style="min-height: 490px">
            <img
              mat-card-image
              style="min-height: 230px"
              [src]="this.checkProjectImage(project?.imageURL)"
              alt="Project 1"
            />
            <mat-card-header>
              <mat-card-title>{{ project?.name }}</mat-card-title>
              <mat-card-subtitle>
                Estado:
                {{
                  project?.statusId === 1
                    ? 'Nuevo'
                    : project?.statusId === 2
                      ? 'En Progreso'
                      : 'Estado Desconocido'
                }}
              </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p style="font-size: small">Descripci√≥n del proyecto: {{ project?.description }}</p>
              <p style="font-size: small">Cliente: {{ project?.client?.name }}</p>
              <p style="font-size: smaller">Fecha Inicio: {{ project?.startDate }}</p>
              <p style="font-size: smaller">Fecha Entrega: {{ project?.endDate }}</p>
            </mat-card-content>
            <mat-card-actions>
              <button mat-icon-button (click)="openDialogEditar(project)" matTooltip="Editar">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button (click)="openEliminar(project)" matTooltip="Eliminar">
                <mat-icon>delete</mat-icon>
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
        <mat-paginator
        
        [length]="proyectosList.length"
        [pageSize]="pageSize"
        [pageSizeOptions]="pageSizeOptions"
        (page)="onPageChange($event)"
        showFirstLastButtons 
      ></mat-paginator>
      </div>
    </div>
  </div>
</body>
