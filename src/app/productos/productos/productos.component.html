
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script>


const myDialog = document.querySelector('#my-dialog');
myDialog.showModal();

function closeDialog() {
  myDialog.close();
}

$(document).ready(function(){
	// Activate tooltip
	$('[data-toggle="tooltip"]').tooltip();

	// Select/Deselect checkboxes
	var checkbox = $('table tbody input[type="checkbox"]');
	$("#selectAll").click(function(){
		if(this.checked){
			checkbox.each(function(){
				this.checked = true;
			});
		} else{
			checkbox.each(function(){
				this.checked = false;
			});
		}
	});
	checkbox.click(function(){
		if(!this.checked){
			$("#selectAll").prop("checked", false);
		}
	});
});
</script>
<body>
	<br><br>
	<div class="container-fluid">
		<div class="container">
		  <div class="row">
			<div class="col-sm-6">
			  <h2>Productos <b>registrados</b></h2>
			</div>

			<div class="col-sm-6 text-right">
        <button mat-raised-button color="secondary" (click)="exportTable()">
          <mat-icon>download</mat-icon> Exportar
        </button>
			  <button mat-raised-button color="primary" (click)="openDialog()">
				<mat-icon>add</mat-icon> Crear Producto
			  </button>
			</div>
      <div class="col-sm-6">
        <mat-form-field appearance="fill">
        <mat-label>Buscar productos</mat-label>
        <mat-icon matPrefix>search</mat-icon>
          <input
            matInput
            type="text"
            id="searchInput"
            [(ngModel)]="searchTerm"
            (ngModelChange)="applyFilter()"
          />
        </mat-form-field>
  
        </div>
		  </div>

      <div class="table-responsive">
        <mat-table [dataSource]="filteredProductos">
          <ng-container matColumnDef="name">
            <mat-header-cell *matHeaderCellDef>Nombre</mat-header-cell>
            <mat-cell *matCellDef="let producto">{{ producto.name }}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="details">
            <mat-header-cell *matHeaderCellDef>Detalles</mat-header-cell>
            <mat-cell *matCellDef="let producto">{{ producto.details }}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="price">
            <mat-header-cell *matHeaderCellDef>Precio</mat-header-cell>
            <mat-cell *matCellDef="let producto">{{ producto.price }}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="providerId">
            <mat-header-cell *matHeaderCellDef>Proveedor</mat-header-cell>
            <mat-cell *matCellDef="let producto">{{ producto.provider.name }}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="unitId">
            <mat-header-cell *matHeaderCellDef>ID de la Unidad</mat-header-cell>
            <mat-cell *matCellDef="let producto">{{ producto.unitId }}</mat-cell>
          </ng-container>
          
          <ng-container matColumnDef="quantity">
            <mat-header-cell *matHeaderCellDef>Cantidad</mat-header-cell>
            <mat-cell *matCellDef="let producto">{{ producto.quantity }}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="actions">
            <mat-header-cell *matHeaderCellDef>Acciones</mat-header-cell>
            <mat-cell *matCellDef="let producto">
            <button mat-icon-button (click)="openDialogEditar(producto)" matTooltip="Editar">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button (click)="openDetailsDialog(producto)" matTooltip="Ver detalles">
              <mat-icon>details</mat-icon>
            </button>
            <button mat-icon-button (click)="openEliminar(producto)" matTooltip="Eliminar">
              <mat-icon>delete</mat-icon>
            </button>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
        </mat-table>
        <mat-paginator
        [length]="productoList.length"
        [pageSize]="pageSize"
        [pageSizeOptions]="pageSizeOptions"
        (page)="onPageChange($event)"
      ></mat-paginator>
      </div>
	  </div>
</div>
