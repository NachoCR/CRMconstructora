<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.18.0/font/bootstrap-icons.css"
  integrity="sha384-GLhlTQ8iKt6iOpTJMLlGzNqibZiJxz5F3J1qIjK7pNEy"
  crossorigin="anonymous"
/>
<mat-dialog-content class="custom-dialog-content" style="height: 100% !important">
  <div class="container-fluid">
    <div class="row mt-3">
      <div class="col">
        <form [formGroup]="editarUsuarioForm" (ngSubmit)="editar()" novalidate autocomplete="">
          <h3>Edición de Usuarios</h3>

          <div class="form-row">
            <!-- Nombre -->
            <div class="form-group col-md-4" style="width: auto">
              <label for="name" class="control-label font-weight-bold">Nombre</label>
              <input
                type="text"
                class="form-control"
                placeholder="Nombre"
                formControlName="name"
                [(ngModel)]="data.name"
              />
            </div>

            <!-- Primer apellido -->
            <div class="form-group col-md-4">
              <label for="lastname" class="control-label font-weight-bold">Primer Apellido</label>
              <input
                type="text"
                class="form-control"
                placeholder="Primer apellido"
                formControlName="lastname"
                [(ngModel)]="data.lastname"
              />
            </div>

            <!-- Segundo apellido -->
            <div class="form-group col-md-4">
              <label for="lastsecondname" class="control-label font-weight-bold"
                >Segundo Apellido</label
              >
              <input
                type="text"
                class="form-control"
                placeholder="Segundo apellido"
                formControlName="secondLastname"
                [(ngModel)]="data.secondLastname"
              />
            </div>
          </div>

          <div class="form-row">
            <!-- Cédula -->
            <div class="form-group col-md-4">
              <label class="control-label font-weight-bold">Tipo de identificación</label>
              <select
                formControlName="identifierId"
                [(ngModel)]="data.identifierId"
                class="form-select"
                [ariaDisabled]="true"
                style="border-radius: 2px"
              >
                <option value="1">Cédula</option>
                <option value="2">Pasaporte</option>
                <option value="3">Cédula jurídica</option>
              </select>
            </div>

            <!-- Identificación -->
            <div
              class="form-group col-md-6"
              *ngIf="editarUsuarioForm.get('identifierId')?.value === '1'"
            >
              <label for="identification" class="control-label font-weight-bold">Cédula</label>
              <input
                type="text"
                class="form-control"
                placeholder="Cédula"
                formControlName="identification"
                [(ngModel)]="data.identification"
                [ngClass]="{
                  'is-valid': (f.identification.dirty || submitted) && !f.identification.errors,
                  'is-invalid': (f.identification.dirty || submitted) && f.identification.errors
                }"
                (focusout)="checkCedulaExists()"
                maxlength="9"
                minlength="9"
              />
              <div class="invalid-feedback">
                <span class="text-danger" *ngIf="f.identification.errors?.required"
                  >La cédula es requerida</span
                >
                <span class="text-danger" *ngIf="f.identification.errors?.pattern"
                  >La cedula debe tener 9 dígitos y solo contener numeros</span
                >
                <span class="text-danger" *ngIf="f.identification.errors?.cedulaExists"
                  >Esta cédula ya está registrada</span
                >

                <!-- Validaciones existentes -->
                <!-- <span class="text-danger" *ngIf="f.identification.errors?.maxLengthValid">Debe ser de 9 caracteres</span>
                <div [ngClass]="{ 'text-sucess': minLengthValid, 'text-danger': !minLengthValid }">
                  <i [attr.class]="minLengthValid ? 'bi-check-square-fill' : 'bi-x-square'"></i>
                  Debe ser mínimo de 9 caracteres
                </div> -->
              </div>
            </div>

            <div
              class="form-group col-md-6"
              *ngIf="editarUsuarioForm.get('identifierId')?.value === '2'"
            >
              <label for="identification" class="control-label font-weight-bold">Pasaporte</label>
              <input
                type="text"
                class="form-control"
                placeholder="Pasaporte"
                formControlName="passport"
                [(ngModel)]="data.identification"
                [ngClass]="{
                  'is-valid': (f.passport.dirty || submitted) && !f.passport.errors,
                  'is-invalid': (f.passport.dirty || submitted) && f.passport.errors
                }"
                (focusout)="checkJuridicExists()"
                maxlength="9"
                minlength="9"
              />
              <div class="invalid-feedback">
                <span class="text-danger" *ngIf="f.passport.errors?.required"
                  >El pasaporte es requerida</span
                >
                <span class="text-danger" *ngIf="f.passport.errors?.pattern"
                  >El pasaporte debe tener 9 dígitos y solo contener numeros</span
                >
                <span class="text-danger" *ngIf="f.passport.errors?.passportExists"
                  >Este pasaporte ya está registrado</span
                >

                <!-- Validaciones existentes -->
                <!-- <span class="text-danger" *ngIf="f.identification.errors?.maxLengthValid">Debe ser de 9 caracteres</span>
                <div [ngClass]="{ 'text-sucess': minLengthValid, 'text-danger': !minLengthValid }">
                  <i [attr.class]="minLengthValid ? 'bi-check-square-fill' : 'bi-x-square'"></i>
                  Debe ser mínimo de 9 caracteres
                </div> -->
              </div>
            </div>

            <div
              class="form-group col-md-6"
              *ngIf="editarUsuarioForm.get('identifierId')?.value === '3'"
            >
              <label for="identification" class="control-label font-weight-bold"
                >Cédula jurídica</label
              >
              <input
                type="text"
                class="form-control"
                placeholder="Cédula jurídica"
                formControlName="juridic"
                [(ngModel)]="data.identification"
                [ngClass]="{
                  'is-valid': (f.juridic.dirty || submitted) && !f.juridic.errors,
                  'is-invalid': (f.juridic.dirty || submitted) && f.juridic.errors
                }"
                (focusout)="checkJuridicExists()"
                maxlength="11"
                minlength="11"
              />
              <div class="invalid-feedback">
                <span class="text-danger" *ngIf="f.juridic.errors?.required"
                  >La cédula juridica es requerida</span
                >
                <span class="text-danger" *ngIf="f.juridic.errors?.pattern"
                  >La cedula juridica debe tener 11 dígitos y solo contener numeros</span
                >
                <span class="text-danger" *ngIf="f.juridic.errors?.juridicExists"
                  >Esta cedula juridica ya está registrada</span
                >

                <!-- Validaciones existentes -->

                <div [ngClass]="{ 'text-sucess': minLengthValid, 'text-danger': !minLengthValid }">
                  <i [attr.class]="minLengthValid ? 'bi-check-square-fill' : 'bi-x-square'"></i>
                  Debe ser mínimo de 11 caracteres
                </div>
              </div>
            </div>
          </div>

          <div class="form-row">
            <!-- Rol -->
            <div class="form-group col-md-4">
              <label for="roleId" class="control-label font-weight-bold">Rol</label>
              <select
                formControlName="roleId"
                class="form-select"
                style="border-radius: 2px"
                [(ngModel)]="data.roleId"
              >
                <option value="1">Cliente</option>
                <option value="2">Empleado</option>
              </select>
            </div>

            <!-- Posición -->
            <div class="form-group col-md-4" *ngIf="editarUsuarioForm.get('roleId')?.value === '2'">
              <label for="position" class="control-label font-weight-bold">Posición</label>
              <select formControlName="position" class="form-select" style="border-radius: 2px">
                <option value="1">Electrico</option>
                <option value="1">Plomero</option>
                <option value="1">Obrero</option>
                <option value="2">Maestro de obras</option>
              </select>
            </div>

            <!-- Proyecto a asignar -->
            <div class="form-group col-md-4" *ngIf="editarUsuarioForm.get('roleId')?.value === '2'">
              <label for="assignedProject" class="control-label font-weight-bold"
                >Proyecto a asignar</label
              >
              <input
                type="text"
                placeholder="Buscar proyecto"
                formControlName="assignedProject"
                [matAutocomplete]="auto"
                [(ngModel)]="data.assignedProject"
                class="form-control"
              />
              <mat-autocomplete #auto="matAutocomplete">
                <mat-option
                  (click)="setProjectValue(proyecto)"
                  *ngFor="let proyecto of filteredProyectosList$ | async"
                  [value]="proyecto.projectId"
                >
                  {{ proyecto.name }}
                </mat-option>
              </mat-autocomplete>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group col-md-4">
              <label for="email" class="control-label font-weight-bold">Correo</label>
              <input
                type="email"
                class="form-control"
                formControlName="email"
                placeholder="correo@gmail.com"
                [(ngModel)]="data.email"
                [ngClass]="{
                  'is-valid': (f.email.dirty || submitted) && !f.email.errors,
                  'is-invalid': (f.email.dirty || submitted) && f.email.errors
                }"
                (focusout)="checkEmailExists()"
              />
              <div class="invalid-feedback">
                <span class="text-danger" *ngIf="f.email.errors?.required"
                  >Es requerido el correo electrónico</span
                >
                <span class="text-danger" *ngIf="f.email.errors?.email"
                  >Correo electrónico inválido</span
                >
                <span class="text-danger" *ngIf="f.email.errors?.emailExists"
                  >Este correo electrónico ya está registrado</span
                >
              </div>
            </div>

            <div class="form-group col-md-4">
              <label for="phone" class="control-label font-weight-bold">Teléfono</label>
              <input
                type="text"
                class="form-control"
                formControlName="phone"
                placeholder="12345678"
                maxlength="8"
                minlength="8"
                [(ngModel)]="data.phone"
                [ngClass]="{
                  'is-valid': (f.phone.dirty || submitted) && !f.phone.errors,
                  'is-invalid': (f.phone.dirty || submitted) && f.phone.errors
                }"
              />

              <!-- <div *ngIf="crearUForm.get('phone')?.hasError('invalidPhoneNumber')">
            <small class="text-danger">Ingrese un número de teléfono válido (8 dígitos).</small>
          </div> -->
              <div class="invalid-feedback">
                <span class="text-danger" *ngIf="f.phone.errors?.required"
                  >El numero de teléfono es requerido</span
                >
                <span class="text-danger" *ngIf="f.phone.errors?.pattern"
                  >El número debe tener 8 dígitos y solo contener números</span
                >

                <!-- Validaciones existentes -->
                <!-- <span class="text-danger" *ngIf="f.identification.errors?.maxLengthValid">Debe ser de 9 caracteres</span>
            <div [ngClass]="{ 'text-sucess': minLengthValid, 'text-danger': !minLengthValid }">
              <i [attr.class]="minLengthValid ? 'bi-check-square-fill' : 'bi-x-square'"></i>
              Debe ser mínimo de 9 caracteres
            </div> -->
              </div>
            </div>
          </div>

          <mat-dialog-actions class="custom-dialog-actions">
            <button mat-button (click)="onNoClick()" class="btn btn-default">Cancelar</button>
            <button
              mat-button
              [disabled]="editarUsuarioForm.invalid"
              (click)="transformData()"
              [mat-dialog-close]="data"
              cdkFocusInitial
              class="btn btn-success"
            >
              Guardar
            </button>
          </mat-dialog-actions>
        </form>
      </div>
    </div>
  </div>
</mat-dialog-content>
